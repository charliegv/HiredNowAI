services:
  # -----------------------------------------------------
  # 1. Web App
  # -----------------------------------------------------
  - type: web
    name: hirednow-web
    env: python
    branch: master
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn app:app
    plan: starter
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false
      - key: AWS_S3_BUCKET
        sync: false

  # -----------------------------
  # PLAYWRIGHT WORKER SERVICE
  # -----------------------------
  - type: worker
    name: hirednow-worker
    runtime: docker
    dockerfilePath: ./Dockerfile
    autoDeploy: true
    plan: starter
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false
      - key: S3_BUCKET
        sync: false
      - key: PYTHONUNBUFFERED
        value: "1"

      # -----------------------
      # YOUR CUSTOM ENV VARS
      # -----------------------
      - key: SHOW_BROWSER
        value: "false"
      - key: CV_GENERATION_TEST
        value: "false"
      - key: TEST_MODE
        value: "false"
      - key: DEBUG_MODE
        value: "true"
      - key: CAPSOLVER_API_KEY
        sync: false   # secret API key stored safely in Render dashboard

  # -----------------------------------------------------
  # 3. Cron Job 1 – Process XML Feed (NO Playwright)
  # -----------------------------------------------------
  - type: cron
    name: cron-process-xml-feed
    env: python
    branch: master
    schedule: "0 6 * * *"
    buildCommand: pip install -r requirements.txt
    startCommand: python scripts/process_xml_feed.py
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false

  # -----------------------------------------------------
  # 4. Cron Job 2 – Daily Match Worker (NO Playwright)
  # -----------------------------------------------------
  - type: cron
    name: cron-daily-match-worker
    env: python
    branch: master
    schedule: "10 6 * * *"
    buildCommand: pip install -r requirements.txt
    startCommand: python workers/daily_match_worker.py
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false

  # -----------------------------------------------------
  # 5. Cron Job 3 – Matches To Apply (USES Playwright)
  # -----------------------------------------------------
  - type: cron
    name: cron-matches-to-apply
    env: python
    branch: master
    schedule: "*/10 * * * *"
    buildCommand: pip install -r requirements.txt
    startCommand: python workers/matches_to_apply.py
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false

  # -----------------------------------------------------
  # Matching Worker
  # -----------------------------------------------------
  - type: worker
    name: hirednow-match-worker
    env: python
    branch: master
    buildCommand: pip install -r requirements.txt
    startCommand: python workers/match_worker.py
    plan: starter
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: OPENAI_API_KEY
        sync: false

# -----------------------------------------------------
# 6. Cron Job – Lifecycle Email Triggers
# -----------------------------------------------------
  - type: cron
    name: cron-lifecycle-emails
    env: python
    branch: master
    schedule: "0 * * * *"   # every hour
    buildCommand: pip install -r requirements.txt
    startCommand: python workers/email_triggers.py
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: MAILGUN_DOMAIN
        sync: false
      - key: MAILGUN_API_KEY
        sync: false
  # -----------------------------------------------------
  # 7. Cron Job – SEO Snapshots + Sitemap
  # -----------------------------------------------------
  - type: cron
    name: cron-seo-snapshots
    env: python
    branch: master
    schedule: "0 9 * * *"   # daily at 09:00 UTC
    buildCommand: pip install -r requirements.txt
    startCommand: python workers/seo_snapshot_worker.py
    envVars:
      - key: DATABASE_URL
        sync: false
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false
      - key: AWS_S3_BUCKET
        sync: false
