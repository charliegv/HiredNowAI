{% extends "layout.html" %}

{% block content %}

<div class="max-w-4xl mx-auto bg-white p-10 rounded-2xl shadow-md">

  <!-- CURRENCY SWITCH -->
  <div class="flex justify-end mb-6">
    <div class="inline-flex rounded-full border border-gray-300 p-1 text-sm">
      <button type="button" data-currency="GBP"
              class="currency-btn px-4 py-1 rounded-full font-semibold transition">
        GBP Â£
      </button>
      <button type="button" data-currency="USD"
              class="currency-btn px-4 py-1 rounded-full font-semibold transition">
        USD $
      </button>
    </div>
  </div>

  <!-- HEADER -->
  <h1 class="text-3xl font-bold text-gray-900 text-center mb-2">
    Continue with one-off credit packs
  </h1>

  <p class="text-gray-700 text-center mb-2 font-medium">
    One-time purchase. No subscription. No ongoing charges.
  </p>

  <p class="text-sm text-gray-500 text-center mb-4">
    Buy credits once and use them whenever you want. Nothing renews automatically.
  </p>

  <!-- TOP SOCIAL PROOF -->
  <div class="flex justify-center mb-8">
    <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full
                bg-green-50 border border-green-200 text-sm text-green-800">
      <span class="font-semibold">94 users</span>
      bought credits in the last 24 hours
    </div>
  </div>

  <!-- CREDIT PACKS -->
  {% for currency, packs in credit_packs.items() %}
  <div class="plan-group grid grid-cols-1 md:grid-cols-3 gap-6 mb-10"
       data-currency="{{ currency }}">

    {% for pack in packs %}
    <div class="border border-gray-300 rounded-xl p-6 text-center hover:shadow-md transition">

      <!-- BADGES -->
      <div class="mb-2 flex flex-wrap justify-center gap-2">

        {# MIDDLE OPTION ONLY #}
        {% if loop.index == 2 %}
        <span class="px-3 py-1 text-xs font-medium bg-blue-100 text-blue-700 rounded-full">
          Popular today
        </span>
        {% endif %}

      </div>

      <p class="text-4xl font-bold text-gray-900">
        {{ pack.credits }}
      </p>

      <p class="text-sm text-gray-600 mt-1">
        applications
      </p>

      <p class="text-xl font-semibold text-gray-900 mt-3">
        {{ pack.currency_symbol }}{{ pack.price }}
      </p>

      <p class="text-xs text-gray-500 mt-1">
        Credits remain valid for 12 months
      </p>

      <!-- MICRO SOCIAL PROOF -->
      {% if loop.index == 1 %}
        <p class="text-xs text-gray-500 mt-2">
          23 users bought this today
        </p>
      {% elif loop.index == 2 %}
        <p class="text-xs text-gray-500 mt-2">
          45 users bought this today
        </p>
      {% elif loop.index == 3 %}
        <p class="text-xs text-gray-500 mt-2">
          8 users bought this today
        </p>
      {% endif %}

      <a href="{{ url_for('billing.buy_credits', price_id=pack.price_id, next='cv_edit') }}"
         class="inline-flex items-center justify-center mt-5
                w-full px-4 py-3 rounded-full
                bg-blue-600 text-white
                text-sm font-semibold
                hover:bg-blue-700 transition shadow">
        Buy credits
      </a>

      <p class="text-[11px] text-gray-400 mt-2">
        This is a single one-off payment
      </p>

    </div>
    {% endfor %}

  </div>
  {% endfor %}

  <!-- EXIT -->
  <div class="border-t pt-6 text-center">
    <a href="{{ url_for('onboarding.edit_cv') }}"
       class="text-sm text-gray-600 hover:text-gray-900 transition">
      Skip for now and finish setup
    </a>
  </div>

</div>

<!-- CURRENCY SWITCH SCRIPT -->
<script>
(function () {
  const groups = document.querySelectorAll(".plan-group");
  const buttons = document.querySelectorAll(".currency-btn");

  function setCurrency(currency) {
    groups.forEach(g => {
      g.style.display = g.dataset.currency === currency ? "grid" : "none";
    });

    buttons.forEach(b => {
      const active = b.dataset.currency === currency;
      b.classList.toggle("bg-blue-600", active);
      b.classList.toggle("text-white", active);
      b.classList.toggle("bg-white", !active);
      b.classList.toggle("text-gray-700", !active);
    });

    localStorage.setItem("preferred_currency", currency);
  }

  const saved = localStorage.getItem("preferred_currency");
  if (saved) {
    setCurrency(saved);
  } else {
    const locale = navigator.language || "";
    setCurrency(locale.startsWith("en-GB") ? "GBP" : "USD");
  }

  buttons.forEach(btn => {
    btn.addEventListener("click", () => {
      setCurrency(btn.dataset.currency);
    });
  });
})();
</script>

{% endblock %}
