{% extends "layout.html" %}

{% block content %}

<div class="max-w-3xl mx-auto bg-white p-10 rounded-2xl shadow-md">

  <!-- Header -->
  <div class="mb-8">
    <h1 class="text-3xl font-bold text-gray-900">Your Preferences</h1>
    <p class="text-gray-600 text-sm mt-1">
      Update how HiredNow AI searches and applies for roles on your behalf.
    </p>
  </div>

  <!-- Flash messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      {% for category, message in messages %}
        <div class="mb-4 p-3 rounded-xl text-sm font-medium
          {% if category == 'error' %}
            bg-red-100 text-red-700
          {% else %}
            bg-green-100 text-green-700
          {% endif %}">
          {{ message }}
        </div>
      {% endfor %}
    {% endif %}
  {% endwith %}

  <!-- FORM START -->
  <form method="POST" class="space-y-12">

    <!-- APPLICATION MODE -->
    <section>
      <h2 class="text-xl font-semibold text-gray-900 mb-2">Application mode</h2>
      <p class="text-gray-600 text-sm mb-4">
        Choose whether HiredNow AI applies automatically or waits for your approval.
      </p>

      <select name="application_mode"
              class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-600">
        <option value="auto" {% if profile.application_mode == "auto" %}selected{% endif %}>Auto-apply</option>
        <option value="approval" {% if profile.application_mode == "approval" %}selected{% endif %}>Approval required</option>
      </select>
    </section>

    <!-- MATCH MODE -->
    <section>
      <h2 class="text-xl font-semibold text-gray-900 mb-2">Matching strictness</h2>
      <p class="text-gray-600 text-sm mb-4">
        Control how strict or broad your job recommendations should be.
      </p>

      <select name="match_mode"
              class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-600">
        <option value="safe" {% if profile.match_mode == "safe" %}selected{% endif %}>Safe (very strict)</option>
        <option value="standard" {% if profile.match_mode == "standard" %}selected{% endif %}>Standard</option>
        <option value="adventurous" {% if profile.match_mode == "adventurous" %}selected{% endif %}>Adventurous (broad)</option>
      </select>
    </section>

    <!-- JOB TITLES -->
    <section>
      <h2 class="text-xl font-semibold text-gray-900 mb-2">Job titles</h2>
      <p class="text-gray-600 text-sm mb-4">Add the roles you want HiredNow AI to prioritise.</p>

      <input type="text"
             name="job_titles"
             value="{{ profile.job_titles or '' }}"
             class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-600"
             placeholder="Software Engineer, Product Manager">

      <p class="text-xs text-gray-500 mt-1">Separate multiple titles with commas.</p>
    </section>

    <!-- CITY & STATE UPDATE -->
    <section>
      <h2 class="text-xl font-semibold text-gray-900 mb-2">Your location</h2>
      <p class="text-gray-600 text-sm mb-4">These details help us calculate distance and find local roles.</p>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

        <!-- CITY -->
        <div>
          <label class="block text-gray-700 font-medium mb-1">City</label>
          <input type="text"
                 name="city"
                 value="{{ profile.city or '' }}"
                 placeholder="London"
                 class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-600">
        </div>

        <!-- STATE -->
        <div>
          <label class="block text-gray-700 font-medium mb-1">State / Region</label>
          <input type="text"
                 name="state"
                 value="{{ profile.state or '' }}"
                 placeholder="Greater London"
                 class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-600">
        </div>

      </div>
    </section>

    <!-- LOCATION MODE (LOCAL vs NATIONWIDE) -->
    <section>
      <h2 class="text-xl font-semibold text-gray-900 mb-3">On-site role search area</h2>

      <div class="space-y-4">

        <!-- LOCAL -->
        <label class="block cursor-pointer">
          <input type="radio"
                 name="location_scope"
                 value="local"
                 class="peer hidden"
                 {% if profile.location_scope == 'local' %}checked{% endif %}>

          <div class="border border-gray-300 rounded-2xl p-5 bg-white shadow-sm transition
                      peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:ring-2 peer-checked:ring-orange-200">

            <h3 class="text-lg font-semibold text-gray-900">Local search radius</h3>
            <p class="text-gray-600 text-sm">Limit search to nearby roles.</p>
          </div>
        </label>

        <!-- NATIONWIDE -->
        <label class="block cursor-pointer">
          <input type="radio"
                 name="location_scope"
                 value="nationwide"
                 class="peer hidden"
                 {% if profile.location_scope != 'local' %}checked{% endif %}>

          <div class="border border-gray-300 rounded-2xl p-5 bg-white shadow-sm transition
                      peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:ring-2 peer-checked:ring-orange-200">

            <h3 class="text-lg font-semibold text-gray-900">Nationwide</h3>
            <p class="text-gray-600 text-sm">Search anywhere in your country.</p>
          </div>
        </label>

      </div>

      <!-- LOCAL DISTANCE SLIDER -->
      <div id="radiusContainer" class="mt-4 {% if profile.location_scope != 'local' %}hidden{% endif %}">
        <h3 class="font-semibold text-gray-900 mb-2">Distance</h3>

        <input type="range"
               name="miles_distance"
               min="20" max="300"
               value="{{ profile.miles_distance or 20 }}"
               id="radiusSlider"
               class="w-full accent-orange-500">

        <p class="text-gray-800 mt-1">
          <span id="radiusValue">{{ profile.miles_distance or 20 }}</span> miles
        </p>
      </div>
    </section>

    <!-- REMOTE PREFS -->
    <section>
      <h2 class="text-xl font-semibold text-gray-900 mb-3">Remote preferences</h2>

      <div class="space-y-4">

        <!-- No Remote -->
        <label class="block cursor-pointer">
          <input type="radio"
                 name="remote_mode"
                 value="none"
                 class="peer hidden"
                 {% if not profile.remote_preference %}checked{% endif %}>

          <div class="border border-gray-300 rounded-2xl p-5 bg-white shadow-sm transition
                      peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:ring-2 peer-checked:ring-orange-200">
            <h3 class="text-lg font-semibold">No remote roles</h3>
            <p class="text-gray-600 text-sm">Only on-site or hybrid jobs.</p>
          </div>
        </label>

        <!-- Remote Nationwide -->
        <label class="block cursor-pointer">
          <input type="radio"
                 name="remote_mode"
                 value="nationwide"
                 class="peer hidden"
                 {% if profile.remote_preference and not profile.worldwide_remote %}checked{% endif %}>

          <div class="border border-gray-300 rounded-2xl p-5 bg-white shadow-sm transition
                      peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:ring-2 peer-checked:ring-orange-200">
            <h3 class="text-lg font-semibold">Remote (nationwide)</h3>
            <p class="text-gray-600 text-sm">Remote jobs anywhere in your country.</p>
          </div>
        </label>

        <!-- Remote Worldwide -->
        <label class="block cursor-pointer">
          <input type="radio"
                 name="remote_mode"
                 value="worldwide"
                 class="peer hidden"
                 {% if profile.worldwide_remote %}checked{% endif %}>

          <div class="border border-gray-300 rounded-2xl p-5 bg-white shadow-sm transition
                      peer-checked:border-orange-500 peer-checked:bg-orange-50 peer-checked:ring-2 peer-checked:ring-orange-200">
            <h3 class="text-lg font-semibold">Remote (worldwide)</h3>
            <p class="text-gray-600 text-sm">Work-from-anywhere roles globally.</p>
          </div>
        </label>

      </div>
    </section>

    <!-- SALARY -->
    <section>
      <h2 class="text-xl font-semibold text-gray-900 mb-2">Salary range</h2>

      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">

        <div>
          <label class="block text-gray-700">Minimum salary</label>
          <input type="number"
                 name="min_salary"
                 value="{{ profile.min_salary or '' }}"
                 class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-600">
        </div>

        <div>
          <label class="block text-gray-700">Maximum salary</label>
          <input type="number"
                 name="max_salary"
                 value="{{ profile.max_salary or '' }}"
                 class="w-full border border-gray-300 rounded-xl p-3 focus:ring-2 focus:ring-blue-600">
        </div>

      </div>
    </section>

    <!-- SAVE BUTTON -->
    <button class="w-full bg-blue-600 text-white py-4 rounded-full text-lg font-semibold hover:bg-blue-700 transition shadow-md">
      Save preferences
    </button>

  </form>
</div>

<!-- SLIDER SCRIPT -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  const slider = document.getElementById("radiusSlider");
  const value = document.getElementById("radiusValue");
  const radioLocal = document.querySelector("input[value='local']");
  const radioNation = document.querySelector("input[value='nationwide']");
  const container = document.getElementById("radiusContainer");

  function toggleRadius() {
    if (radioLocal.checked) container.classList.remove("hidden");
    else container.classList.add("hidden");
  }

  slider?.addEventListener("input", () => value.textContent = slider.value);
  radioLocal?.addEventListener("change", toggleRadius);
  radioNation?.addEventListener("change", toggleRadius);

  toggleRadius();
});
</script>

{% endblock %}
